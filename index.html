<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funday 2025 Final - Parcours GPX</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        #map {
            height: calc(100vh - 140px);
            width: 100%;
            border-radius: 0;
        }
        
        .controls {
            position: absolute;
            top: 160px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        .btn.active {
            background: #667eea;
            color: white;
        }
        
        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            max-width: 300px;
            backdrop-filter: blur(10px);
        }
        
        .info-panel h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.2em;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 500;
            color: #666;
        }
        
        .info-value {
            font-weight: 600;
            color: #333;
        }
        
        .user-marker {
            background: #ff4757;
            border: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .controls {
                top: 140px;
                right: 10px;
            }
            
            .info-panel {
                bottom: 10px;
                left: 10px;
                max-width: calc(100% - 20px);
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèÉ‚Äç‚ôÇÔ∏è Funday 2025 Final</h1>
        <p>Parcours GPX - Cliquez sur "Me localiser" pour voir votre position sur le parcours</p>
    </div>
    
    <div class="controls">
        <button class="btn" id="locateBtn" onclick="locateUser()">üìç Me localiser</button>
        <button class="btn" id="centerBtn" onclick="centerOnTrack()">üéØ Centrer parcours</button>
        <button class="btn" id="toggleElevation" onclick="toggleElevationProfile()">üìä Profil altitude</button>
    </div>
    
    <div id="map"></div>
    
    <div class="info-panel">
        <h3>üìà Informations du parcours</h3>
        <div class="info-item">
            <span class="info-label">Distance:</span>
            <span class="info-value" id="distance">Calcul...</span>
        </div>
        <div class="info-item">
            <span class="info-label">Dur√©e:</span>
            <span class="info-value" id="duration">Calcul...</span>
        </div>
        <div class="info-item">
            <span class="info-label">Altitude min:</span>
            <span class="info-value" id="minEle">Calcul...</span>
        </div>
        <div class="info-item">
            <span class="info-label">Altitude max:</span>
            <span class="info-value" id="maxEle">Calcul...</span>
        </div>
        <div class="info-item">
            <span class="info-label">D√©nivel√© +:</span>
            <span class="info-value" id="elevGain">Calcul...</span>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Donn√©es GPX extraites du fichier
        const gpxData = [
            [50.45392083004117, 3.9392918162047863, 29.43],
            [50.453867269679904, 3.9397774636745453, 29.8],
            [50.45381379313767, 3.9402631111443043, 29.75],
            [50.4537602327764, 3.9407487586140633, 30.05],
            [50.45370667241514, 3.9412343222647905, 30.65],
            [50.4536531958729, 3.9417199697345495, 31.64],
            [50.45359963551164, 3.9422056172043085, 32.84],
            [50.4535461589694, 3.9426912646740675, 33.75],
            [50.453492598608136, 3.9431769121438265, 34.45],
            [50.453483210876584, 3.9432620722800493, 35.34],
            [50.45368722639978, 3.943637330085039, 36.38],
            [50.453729471191764, 3.943714862689376, 37.5],
            [50.45367783866823, 3.944201013073325, 38.99],
            [50.45362612232566, 3.9446871634572744, 40.82],
            [50.45357448980212, 3.9451733138412237, 42.62],
            [50.453565353527665, 3.9452597312629223, 44.32],
            [50.45365051366389, 3.9457341469824314, 46.1],
            [50.45373567380011, 3.9462085627019405, 47.94],
            [50.453820833936334, 3.9466830622404814, 49.99],
            [50.45383885502815, 3.9467831421643496, 51.75],
            [50.45409198850393, 3.9470758382230997, 53.52],
            [50.45409869402647, 3.9470835495740175, 54.96],
            [50.45390272513032, 3.9474691171199083, 56.62],
            [50.45370675623417, 3.947854768484831, 58.15],
            [50.45351087115705, 3.9482403360307217, 59.33],
            [50.4533149022609, 3.9486259035766125, 60.08],
            [50.45329185202718, 3.9486712496727705, 60.53],
            [50.45328179374337, 3.949163854122162, 60.63],
            [50.453278943896294, 3.9493023231625557, 60.55],
            [50.453162686899304, 3.9495383575558662, 60.16],
            [50.453182300552726, 3.950030207633972, 59.83],
            [50.453190095722675, 3.950224919244647, 59.22],
            [50.453306352719665, 3.950471682474017, 58.6],
            [50.453070821240544, 3.9507984928786755, 57.58],
            [50.45295079238713, 3.9509651251137257, 56.49],
            [50.452738562598825, 3.950601266697049, 55.3],
            [50.45252641662955, 3.9502374082803726, 53.98],
            [50.45236271806061, 3.9499566983431578, 52.8],
            [50.452184937894344, 3.9503107499331236, 51.69],
            [50.45210505835712, 3.9507873449474573, 50.64],
            [50.452082427218556, 3.9509222097694874, 49.81],
            [50.45208561234176, 3.951415065675974, 49.02],
            [50.452088881284, 3.9519078377634287, 48.51],
            [50.452089216560125, 3.9519629068672657, 48.2],
            [50.45240269973874, 3.952004900202155, 48.36],
            [50.45264988206327, 3.9520380087196827, 48.66],
            [50.45265474356711, 3.9525306969881058, 48.8],
            [50.45265952125192, 3.9530234690755606, 49.09],
            [50.45266362838447, 3.953443318605423, 49.5],
            [50.452939895913005, 3.953207703307271, 50.27],
            [50.45321624726057, 3.952972088009119, 51.24],
            [50.45329260639846, 3.952906960621476, 52.24],
            [50.453586308285594, 3.9527301024645567, 53.43],
            [50.453880010172725, 3.952553328126669, 54.64],
            [50.45388068072498, 3.9525529090315104, 55.7],
            [50.45402426272631, 3.9521559420973063, 56.93],
            [50.454297764226794, 3.952027279883623, 58.02],
            [50.454311426728964, 3.9515981264412403, 59.13],
            [50.45445500873029, 3.951329905539751, 60.12],
            [50.454742508009076, 3.9511298295110464, 60.99],
            [50.45503009110689, 3.9509298373013735, 61.49],
            [50.455179708078504, 3.950825734063983, 61.83],
            [50.455309711396694, 3.951274501159787, 61.95],
            [50.45531650073826, 3.9512977190315723, 62.07],
            [50.45532329007983, 3.9515122957527637, 62.0],
            [50.45522756874561, 3.9516946859657764, 61.82],
            [50.45498885214329, 3.9520157128572464, 61.64],
            [50.454988265410066, 3.9520165510475636, 61.32],
            [50.45474896207452, 3.9523061458021402, 60.84],
            [50.454977955669165, 3.95264427177608, 60.22],
            [50.455097649246454, 3.9528211299329996, 59.64],
            [50.45527199283242, 3.9532314240932465, 58.97],
            [50.45537115074694, 3.953464776277542, 58.42],
            [50.45563593506813, 3.95373098552227, 58.01],
            [50.45580876991153, 3.9539046585559845, 57.47],
            [50.456065675243735, 3.9541892241686583, 56.94],
            [50.456157457083464, 3.954290896654129, 56.49],
            [50.45636700466275, 3.954658443108201, 56.0],
            [50.45638988725841, 3.954698508605361, 55.61],
            [50.45660396106541, 3.954337416216731, 55.36],
            [50.4566633887589, 3.954237252473831, 55.03],
            [50.45679339207709, 3.9537884015589952, 54.67],
            [50.45692339539528, 3.953339634463191, 54.31],
            [50.45693680644035, 3.9532931987196207, 53.92],
            [50.45711458660662, 3.9530035201460123, 53.47],
            [50.45741541311145, 3.9528962317854166, 53.01],
            [50.45755899511278, 3.9526923839002848, 52.44],
            [50.457859402522445, 3.9525458682328463, 51.81],
            [50.45806492678821, 3.9524456206709146, 51.23],
            [50.457981107756495, 3.9519706182181835, 50.64],
            [50.45794188044965, 3.9517483301460743, 50.0],
            [50.45789401978254, 3.951533753424883, 49.39],
            [50.457764100283384, 3.951211888343096, 48.85],
            [50.458034835755825, 3.950960850343108, 47.91],
            [50.45821529813111, 3.9507935475558043, 47.13],
            [50.458423253148794, 3.9504236541688442, 46.36],
            [50.458522997796535, 3.950246376916766, 45.49],
            [50.45871435664594, 3.9502892922610044, 44.61],
            [50.458885515108705, 3.949875645339489, 43.4],
            [50.45905667357147, 3.9494620822370052, 42.41],
            [50.4592277482152, 3.9490484353154898, 41.63],
            [50.459309136494994, 3.9488517120480537, 40.94],
            [50.45953477732837, 3.9489375427365303, 40.28],
            [50.45966469682753, 3.949173577129841, 39.67],
            [50.45984541065991, 3.949576998129487, 39.18],
            [50.459972312673926, 3.9498601388186216, 38.76],
            [50.46009368263185, 3.9503148570656776, 38.34],
            [50.4601842071861, 3.95065407268703, 38.03],
            [50.46030675061047, 3.9511080365628004, 37.66],
            [50.46042929403484, 3.951562000438571, 37.37],
            [50.46055183745921, 3.9520159643143415, 37.19],
            [50.46060129068792, 3.9521988574415445, 37.01],
            [50.46072944998741, 3.952649049460888, 36.93],
            [50.460857609286904, 3.9530992414802313, 36.81],
            [50.460888370871544, 3.953207368031144, 36.65],
            [50.46087026596069, 3.9536993857473135, 36.43],
            [50.460867835208774, 3.95376518368721, 36.29],
            [50.46116924844682, 3.9536236971616745, 36.05],
            [50.46147066168487, 3.953482126817107, 35.8],
            [50.46173611655831, 3.953357571735978, 35.57],
            [50.46197533607483, 3.95331465639174, 35.45],
            [50.46170124784112, 3.9530726708471775, 35.51],
            [50.461428416892886, 3.952831858769059, 35.63],
            [50.46128022484481, 3.9523970894515514, 35.67],
            [50.46113203279674, 3.951962236315012, 35.75],
            [50.46111401170492, 3.951909262686968, 35.76],
            [50.46101460233331, 3.951441552489996, 35.69],
            [50.46093623153865, 3.9510724134743214, 35.63],
            [50.46078460291028, 3.9506405778229237, 35.6],
            [50.46063297428191, 3.9502086583524942, 35.62],
            [50.46056709252298, 3.950021071359515, 35.64],
            [50.46047857962549, 3.9495480805635452, 35.63],
            [50.460390066727996, 3.9490750897675753, 35.64],
            [50.4603483248502, 3.9488517120480537, 35.6],
            [50.46009376645088, 3.948562117293477, 35.59],
            [50.460074823349714, 3.948540575802326, 35.51],
            [50.460006510838866, 3.9482509810477495, 35.37],
            [50.45980526134372, 3.9478720352053642, 35.15],
            [50.45976720750332, 3.9478003699332476, 35.03],
            [50.45991523191333, 3.9473654329776764, 34.81],
            [50.46006325632334, 3.9469304122030735, 34.8],
            [50.460143219679594, 3.9466953836381435, 34.81],
            [50.46030239202082, 3.9462701696902514, 34.87],
            [50.46046156436205, 3.945845039561391, 34.85],
            [50.46046449802816, 3.9458371605724096, 34.78],
            [50.460736490786076, 3.9460849296301603, 34.7],
            [50.46100848354399, 3.9463327825069427, 34.56],
            [50.46128047630191, 3.946580635383725, 34.39],
            [50.461552469059825, 3.946828404441476, 34.21],
            [50.46173611655831, 3.9469957910478115, 34.05],
            [50.461654057726264, 3.9472210127860308, 34.01],
            [50.46136169694364, 3.9470387902110815, 34.08],
            [50.46115499921143, 3.946909960359335, 34.02],
            [50.46091259457171, 3.946595722809434, 33.94],
            [50.46067010611296, 3.9462815690785646, 33.78],
            [50.460427701473236, 3.9459674153476954, 33.5],
            [50.46018521301448, 3.9456531777977943, 33.21],
            [50.460095359012485, 3.9455367531627417, 32.91],
            [50.45989570207894, 3.9451557118445635, 32.57],
            [50.459696128964424, 3.944774754345417, 32.28],
            [50.45949647203088, 3.9443937968462706, 31.99],
            [50.459336545318365, 3.9440884441137314, 31.75],
            [50.45920888893306, 3.943637916818261, 31.55],
            [50.459199752658606, 3.9436056464910507, 31.41],
            [50.45922716148198, 3.9433053229004145, 31.38],
            [50.45903714373708, 3.9429124630987644, 31.24],
            [50.45884712599218, 3.9425196032971144, 31.16],
            [50.45879641547799, 3.94241482950747, 31.15],
            [50.45860782265663, 3.9420202933251858, 31.11],
            [50.4584193136543, 3.9416257571429014, 31.17],
            [50.45824262313545, 3.9412561990320683, 31.23],
            [50.45801505446434, 3.9409158937633038, 31.26],
            [50.4577874019742, 3.940575672313571, 31.17],
            [50.457559833303094, 3.9402353670448065, 30.89],
            [50.45737442560494, 3.939958093687892, 30.67],
            [50.457164123654366, 3.939591469243169, 30.46],
            [50.45695382170379, 3.9392248447984457, 30.24],
            [50.456943679600954, 3.9392071589827538, 30.13],
            [50.45673857443035, 3.9389174804091454, 30.04],
            [50.45645283535123, 3.9387112017720938, 29.94],
            [50.45639676041901, 3.9386707171797752, 29.85],
            [50.456237168982625, 3.939095512032509, 29.75],
            [50.45607757754624, 3.9395203068852425, 29.87],
            [50.456013875082135, 3.9396898727864027, 30.09],
            [50.45585252344608, 3.9401130750775337, 30.3],
            [50.45569117181003, 3.940536193549633, 30.65],
            [50.45555580407381, 3.940891418606043, 30.89],
            [50.455291187390685, 3.940624790266156, 31.39],
            [50.45502657070756, 3.9403581619262695, 31.95],
            [50.4548104852438, 3.9401404839009047, 32.2],
            [50.45454327017069, 3.939880393445492, 32.39],
            [50.45427605509758, 3.939620219171047, 32.32],
            [50.454072123393416, 3.939421735703945, 32.12]
        ];
        
        // Initialisation de la carte
        const map = L.map('map').setView([50.455, 3.945], 14);
        
        // Couche de tuiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);
        
        // Convertir les donn√©es en format Leaflet
        const trackPoints = gpxData.map(point => [point[0], point[1]]);
        
        // Cr√©er le trac√© du parcours
        const track = L.polyline(trackPoints, {
            color: '#667eea',
            weight: 4,
            opacity: 0.8,
            smoothFactor: 1
        }).addTo(map);
        
        // Marqueurs de d√©but et fin
        const startIcon = L.divIcon({
            html: '<div style="background: #10ac84; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">üèÅ</div>',
            iconSize: [30, 30],
            className: 'custom-div-icon'
        });
        
        const endIcon = L.divIcon({
            html: '<div style="background: #ee5a52; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">üèÜ</div>',
            iconSize: [30, 30],
            className: 'custom-div-icon'
        });
        
        L.marker(trackPoints[0], {icon: startIcon})
            .addTo(map)
            .bindPopup('<b>üèÅ D√©part</b><br>D√©but du parcours Funday 2025');
        
        L.marker(trackPoints[trackPoints.length - 1], {icon: endIcon})
            .addTo(map)
            .bindPopup('<b>üèÜ Arriv√©e</b><br>Fin du parcours Funday 2025');
        
        // Variables globales
        let userMarker = null;
        let watchId = null;
        let isTracking = false;
        
        // Calculer les statistiques du parcours
        function calculateStats() {
            let distance = 0;
            let elevationGain = 0;
            let minEle = Math.min(...gpxData.map(p => p[2]));
            let maxEle = Math.max(...gpxData.map(p => p[2]));
            
            for (let i = 1; i < gpxData.length; i++) {
                const prev = gpxData[i-1];
                const curr = gpxData[i];
                
                // Distance
                const lat1 = prev[0] * Math.PI / 180;
                const lat2 = curr[0] * Math.PI / 180;
                const deltaLat = (curr[0] - prev[0]) * Math.PI / 180;
                const deltaLon = (curr[1] - prev[1]) * Math.PI / 180;
                
                const a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) +
                         Math.cos(lat1) * Math.cos(lat2) *
                         Math.sin(deltaLon/2) * Math.sin(deltaLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                distance += 6371000 * c;
                
                // D√©nivel√© positif
                if (curr[2] > prev[2]) {
                    elevationGain += curr[2] - prev[2];
                }
            }
            
            document.getElementById('distance').textContent = (distance / 1000).toFixed(2) + ' km';
            document.getElementById('duration').textContent = '~' + Math.round(distance / 1000 / 5 * 60) + ' min'; // Estimation √† 5 km/h
            document.getElementById('minEle').textContent = minEle.toFixed(0) + ' m';
            document.getElementById('maxEle').textContent = maxEle.toFixed(0) + ' m';
            document.getElementById('elevGain').textContent = '+' + elevationGain.toFixed(0) + ' m';
        }
        
        // Localiser l'utilisateur
        function locateUser() {
            const btn = document.getElementById('locateBtn');
            
            if (!isTracking) {
                if (navigator.geolocation) {
                    btn.classList.add('active');
                    btn.textContent = 'üîÑ Localisation...';
                    
                    watchId = navigator.geolocation.watchPosition(
                        function(position) {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            
                            if (userMarker) {
                                map.removeLayer(